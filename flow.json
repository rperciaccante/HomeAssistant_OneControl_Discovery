[
    {
        "id": "c5bf60a40630c5e3",
        "type": "tab",
        "label": "OneControl Discovery",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "43b59d10c7fbb603",
        "type": "tab",
        "label": "OneControl Monitoring",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fbf3308551f314be",
        "type": "tab",
        "label": "Tools",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a2d4a149bd5c14b2",
        "type": "group",
        "z": "fbf3308551f314be",
        "name": "Connect to your OneControl platform and download entities",
        "style": {
            "fill": "#ffffbf",
            "label": true,
            "label-position": "ne"
        },
        "nodes": [
            "2ab54f412889170c",
            "22e486b014509a50",
            "0e37680e62b8250e",
            "398ef1a0a16d08f0",
            "018e9d1e4c093a3e",
            "3d605545bfab8cd3"
        ],
        "x": 54,
        "y": 59
    },
    {
        "id": "2ec83346dffc7d94",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Data Publishing",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "888e1201759d2203",
            "273da8d4173943bb",
            "11af832c02c64601",
            "9be463bbf9a8f997",
            "99f937e3894a08b8",
            "dffd7703ab060e9f",
            "6a2e6e770864cdd0",
            "f11ec4beb8586b8f",
            "3e2a20b42543032b",
            "4a241eecd05a027a",
            "6fc28ef47b87f702",
            "670878733f3ed1be"
        ],
        "x": 954,
        "y": 179,
        "w": 592,
        "h": 342
    },
    {
        "id": "6858fb2384f7f246",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Processing Options",
        "style": {
            "label": true,
            "fill": "#e3f3d3"
        },
        "nodes": [
            "e0aac92236e32259",
            "a80200c65e78f34a",
            "aa1ffe397c27678d",
            "45a56438708b01c9"
        ],
        "x": 954,
        "y": 19,
        "w": 592,
        "h": 142
    },
    {
        "id": "90c01626219c9b6e",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Get current state of entities",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "2246a7b0e41df251",
            "5534c824af950556",
            "ddd5b4ca9b2214d1"
        ],
        "x": 614,
        "y": 319,
        "w": 292,
        "h": 162
    },
    {
        "id": "b07fe501c3da07e1",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Create Control Entities",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "8efc57e27bef52e5",
            "d25248e6a91d7fea"
        ],
        "x": 634,
        "y": 19,
        "w": 272,
        "h": 122
    },
    {
        "id": "4979df7953c906ee",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Enable Debugging",
        "style": {
            "fill": "#ffefbf",
            "label": true
        },
        "nodes": [
            "66b533eb7bb555b6",
            "879a7280e4ff88f2"
        ],
        "x": 614,
        "y": 159,
        "w": 292,
        "h": 142
    },
    {
        "id": "b786722f1abebf90",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Build HVAC Entities",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "098e7e902113652b"
        ],
        "x": 614,
        "y": 499,
        "w": 292,
        "h": 82
    },
    {
        "id": "09ec6382357415d1",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Collect devices from OneControl",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "98f4ba26adf91fe6",
            "ef9ad8391578af6e"
        ],
        "x": 244,
        "y": 39,
        "w": 302,
        "h": 122
    },
    {
        "id": "11cee4e8082393f2",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Gather and process individual control channels",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "f5a3506e1a122e6b",
            "1baacf69c1df92ac",
            "0b7b92b04bceb755",
            "02c44407100b5dfe",
            "25ecfdaf34edb547",
            "0fb7b59456f85d4b"
        ],
        "x": 254,
        "y": 179,
        "w": 299,
        "h": 282
    },
    {
        "id": "4514be5227808dc1",
        "type": "group",
        "z": "c5bf60a40630c5e3",
        "name": "Generate Supplemental Entities",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "af180c05203f3bf8",
            "f3dc76e8144ad4bd",
            "d445b1bb9cd4ab81",
            "4efa180cc4812cc4",
            "7c688006afafe03e"
        ],
        "x": 254,
        "y": 479,
        "w": 312,
        "h": 242
    },
    {
        "id": "6aae06d09c613fad",
        "type": "group",
        "z": "43b59d10c7fbb603",
        "name": "OneControl Event Stream",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "affcfc4989bec16b",
            "ca6fbeb5c26fcf8c",
            "aa5f06d40fe8cb5a",
            "c858ec7c0b44668c",
            "73638f0d908217b1",
            "b8221c75079a0d4c",
            "a7a4976dfe29fe86",
            "86020bb309d0ae86",
            "e3142aa105a58b6f",
            "5c0b50257b9bbe74",
            "4f9578a7eba52f1d",
            "9f8f72780fcd08cd"
        ],
        "x": 34,
        "y": 19
    },
    {
        "id": "c2cef54b587f0bcb",
        "type": "group",
        "z": "43b59d10c7fbb603",
        "name": "OneControl Event Send",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "8f14976b64bb3146",
            "391a9569a63dcb2a",
            "d798d4fbbc01f36d",
            "3e7e3125a5625d70",
            "f2bdd5e747c58fb2",
            "2b59b7ebf7f8c64f",
            "97ebd9ec3e8a6fde",
            "948bd492828276bc",
            "5dfeec5f086a1a5d"
        ],
        "x": 34,
        "y": 239
    },
    {
        "id": "b81fcae9f8b73e0b",
        "type": "group",
        "z": "43b59d10c7fbb603",
        "name": "Entities in Home Assistant that control this integration",
        "style": {
            "fill": "#e3f3d3",
            "label": true
        },
        "nodes": [
            "285a06fd6b523577",
            "c5a20be305249658",
            "0d6b1468c7e8402c",
            "30a5d1b17151aadd",
            "68e445fc2b0a42c7",
            "d6d1322b9d745884",
            "9d3f4ffa65c1772b",
            "94ae0ec5e36d0e7b",
            "93753410a1771126",
            "8d475c51d06f4ba7",
            "00417d306bc2e61c",
            "3b970ff7deaf8436",
            "1cf20926d2520c98"
        ],
        "x": 34,
        "y": 439
    },
    {
        "id": "4410210f.6939c",
        "type": "mqtt-broker",
        "name": "Localhost",
        "broker": "127.0.0.1",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "f5a3506e1a122e6b",
        "type": "split",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Split Individual Channels",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "foo",
        "x": 410,
        "y": 220,
        "wires": [
            [
                "0fb7b59456f85d4b"
            ]
        ]
    },
    {
        "id": "1baacf69c1df92ac",
        "type": "join",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Consolidate Channels",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 420,
        "y": 380,
        "wires": [
            [
                "0b7b92b04bceb755"
            ]
        ]
    },
    {
        "id": "0b7b92b04bceb755",
        "type": "change",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Reorganize Message",
        "rules": [
            {
                "t": "set",
                "p": "thing.channels",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 420,
        "wires": [
            [
                "af180c05203f3bf8"
            ]
        ]
    },
    {
        "id": "ea1e858d19760df3",
        "type": "inject",
        "z": "c5bf60a40630c5e3",
        "name": "Click here to start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 40,
        "wires": [
            [
                "ef9ad8391578af6e"
            ]
        ]
    },
    {
        "id": "af180c05203f3bf8",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "4514be5227808dc1",
        "name": "Build Node Diagnostic Entities",
        "func": "// This node generates sensors that contain the diagnostic values for the device (not the individual sensors)\n\nfunction capitolizeFirst(string) {\n var output = string.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n return output;\n}\n\n\nmsg.payload = \"\"\n    for (const property in msg.thing.configuration) {\n        baseTopic  =                global.get(\"mqttDiscoveryTopic\") + \"/sensor/\" + msg.thing.hass.UID_ha + \"/\" + property\n        msg.topic =                 baseTopic + \"/config\"\n        \n        switch(property){\n            case \"deviceType\":\n                name =              msg.thing.label + \" Device Type\"\n                break;\n            case \"deviceInstance\":\n                name =              msg.thing.label + \" Device Instance\"\n                break;\n            case \"capability\":\n                name =              msg.thing.label + \" Capability\"\n                break;\n            case \"productID\":\n                name =              msg.thing.label + \" Product ID\"\n                break;\n            case \"functionName\":\n                name =              msg.thing.label + \" Function Name\"\n                break;\n            case \"functionInstance\":\n                name =              msg.thing.label + \" Function Instance\"\n                break;\n            case \"mac\":\n                name =              msg.thing.label + \" MAC Address\"\n                break;\n            default:\n                name =              property\n                break;\n            }\n\n    \n        msg.payload = {\n            \"name\":                 name,\n            \"object_id\":            global.get(\"namePrecursor\") + name,\n            \"unique_id\":            msg.thing.hass.UID_ha + \"_\" + property,\n            \"entity_category\":      \"diagnostic\",\n            \"state_topic\":          baseTopic + \"/state\",\n            \"availability\":         {\"topic\":                       msg.thing.hass.availabilityTopic,\n                                    \t\"payload_available\":        msg.thing.hass.availabilityTopicOn,\n                                    \t\"payload_not_available\":    msg.thing.hass.availabilityTopicOff,\n                                    \t\"value_template\":           \"{{ value_json.\" + msg.thing.hass.availabilityTopicAttr + \" }}\", \n                                        },\n            \"device\":               {\"manufacturer\":       global.get(\"deviceManufacturer\"), \n                                        \"via_device\":       global.get(\"deviceViaDevice\"),\n                                        \"identifiers\":      msg.thing.hass.UID_ha, \n                                        \"name\":             msg.thing.label, \n                                        \"model\":            global.get(\"deviceModel\") + \": \" + msg.thing.hass.UID_ha,\n                                        \"sw_version\":       global.get(\"deviceSWVversion\")\n                                    },\n\n            \"enabled_by_default\":   true\n            \n        } \n    msg.type = \"entity\"\n    node.send(msg)\n    \n    \n    // Send the default values from the config to the MQTT topic for the attribute above\n    msg1 = {}\n    msg1.topic = baseTopic + \"/state\"\n    value = msg.thing.configuration[property]\n  /*  \n\n    */\n    if (property == \"deviceType\") {\n            switch(value) {\n                case 10:\n                    value = \"(\" + value + \") Tank Sensor (Relay Control)\"\n                    break;\n                case 16:\n                    value = \"(\" + value + \") HVAC Control (HVAC Control)\"\n                    break;\n                case 20:\n                    value = \"(\" + value + \") Dimmable Light (Lighting Control)\"\n                    break;\n                case 24:\n                    value = \"(\" + value + \") Generator Genie (HVAC Control)\"\n                    break;\n                case 30:\n                    value = \"(\" + value + \") Latching Relay (type 2), (Relay Control)\"\n                    break;\n                }\n            }\n    //msg1.value = value\n    //msg1.property = property\n    msg1.payload = value\n    msg1.type = \"record\"\n    msg1.retain = true\n    node.send(msg1)\n}\n\nreturn [null,msg]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 520,
        "wires": [
            [
                "eedd8594c925dbf3"
            ],
            [
                "f3dc76e8144ad4bd"
            ]
        ]
    },
    {
        "id": "f3dc76e8144ad4bd",
        "type": "switch",
        "z": "c5bf60a40630c5e3",
        "g": "4514be5227808dc1",
        "name": "Process Special Device Types",
        "property": "thing.hass.thingTypeUID_ha",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "hvac",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 560,
        "wires": [
            [
                "098e7e902113652b",
                "d445b1bb9cd4ab81"
            ],
            [
                "d445b1bb9cd4ab81"
            ]
        ]
    },
    {
        "id": "098e7e902113652b",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "b786722f1abebf90",
        "name": "Build HVAC complex entities     ",
        "func": "// ####################### Begin HVAC Device Configuration #######################\n// Home Assistant can use MQTT Discovery to create a HVAC (referred to as a climate entity).\n//   https://www.home-assistant.io/integrations/climate.mqtt/\n// Unlike the other entities, this entity will utilize several different mqtt topics from individual channels\n//   to form the Climate entity.\ni = msg.thing.UID.replace(/:/g,\"_\")\ni = i.replace(\"-\",\"_\")\n\ndiscoveryBaseTopic = global.get(\"mqttDiscoveryTopic\") + \"/climate/\" + msg.thing.hass.UID_ha + \"/hvac\"\nmsg.topic = discoveryBaseTopic + \"/config\"\n\nmsg.payload =   {\n                \"name\":                             msg.thing.label,\n                \"object_id\":                        global.get(\"namePrecursor\") + msg.thing.label,\n                \"unique_id\":                        i,\n                \"enabled_by_default\":               \"true\",\n                \"availability\":                     {   \n                                                        \"topic\":                    msg.thing.hass.availabilityTopic,\n                                                        \"payload_available\":        msg.thing.hass.availabilityTopicOn,\n                                            \t        \"payload_not_available\":    msg.thing.hass.availabilityTopicOff,\n                                            \t        \"value_template\":           \"{{ value_json.\" + msg.thing.hass.availabilityTopicAttr + \" }}\", \n                                                    },\n                \"device\": {\n                    \"manufacturer\":                 global.get(\"deviceManufacturer\"),\n                    \"via_device\":                   global.get(\"via_device\"),\n                    \"identifiers\":                  msg.thing.hass.UID_ha,\n                    \"name\":                         msg.thing.hass.label,\n                    \"model\":                        \"OneControl: \"+ msg.thing.hass.UID_ha,\n                    \"sw_version\":                   \"1.0\"\n                    },\n                \"action_topic\":                     \"smarthome/items/\"+i+\"_status/state\",\n                \"action_template\":                  \"{{ value_json.value }}\",\n                \"current_temperature_topic\":        \"smarthome/items/\"+i+\"_inside_temperature/state\",\n                \"current_temperature_template\":     \"{{ value_json.value }}\",\n                \"fan_mode_command_topic\":           \"smarthome/items/\"+i+\"_fan_mode/set\",\n                \"fan_mode_state_topic\":             \"smarthome/items/\"+i+\"_fan_mode/state\",\n                \"fan_mode_state_template\":          \"{{ value_json.value }}\",\n                \"fan_modes\":                        [\"auto\", \n        \t                                            \"low\", \n        \t                                            \"high\"],\n                \"hold_command_topic\":               \"smarthome/items/\"+i+\"_heat-source/set\",\n                \"hold_state_topic\":                 \"smarthome/items/\"+i+\"_heat-source/state\",\n                \"hold_state_template\":              \"{{ value_json.value }}\",\n                \"hold_modes\":                       [\"Prefer Heatpump\",\n                                                        \"Prefer Gas\"],\n        \t    \"mode_command_topic\":               \"smarthome/items/\"+i+\"_hvac_mode/set\",\n                \"mode_state_topic\":                 \"smarthome/items/\"+i+\"_hvac_mode/state\",\n            \t\"mode_state_template\":              \"{{ value_json.value }}\",\n            \t\"modes\":                            [\"heat\", \n            \t                                        \"cool\",\n            \t                                        \"heat_cool\",\n            \t                                        \"off\"],\n            \t\"min_temp\":                         45,\n            \t\"max_temp\":                         100,\n            \t\"precision\":                        1,\n            \t\"retain\":                           true,\n            \t\"temperature_high_command_topic\":   \"smarthome/items/\"+i+\"_high_temperature/set\",\n            \t\"temperature_high_state_topic\":     \"smarthome/items/\"+i+\"_high_temperature/state\",\n            \t\"temperature_high_state_template\":  \"{{ value_json.value }}\",\n            \t\"temperature_low_command_topic\":    \"smarthome/items/\"+i+\"_low_temperature/set\",\n            \t\"temperature_low_state_topic\":      \"smarthome/items/\"+i+\"_low_temperature/state\",\n            \t\"temperature_low_state_template\":   \"{{ value_json.value }}\",\n            \t\"temp_step\":                        1,\n    }\nmsg.type = \"entity\"\nnode.send(msg)\n\ndiscoveryBaseTopic = global.get(\"mqttDiscoveryTopic\") + \"/sensor/\" + msg.thing.hass.UID_ha + \"/device_mode\"\nmsg.topic = discoveryBaseTopic + \"/config\"\nmsg.payload =   {\n                \"name\":                             msg.thing.label + \" Device State\",\n                \"object_id\":                        global.get(\"namePrecursor\") + msg.thing.label + \" Device State\",\n                \"unique_id\":                        i + \"_device_state\",\n                \"enabled_by_default\":               \"true\",\n                \"availability\":                     {\n                                                    \t\"topic\":                    msg.thing.hass.availabilityTopic,\n                                                    \t\"payload_available\":        \"online\",\n                                                    \t\"payload_not_available\":    \"offline\",\n                                                    \t\"value_template\":           \"{{ value_json.status }}\", \n                                                    },\n                \"device\": {\n                    \"manufacturer\":                 global.get(\"deviceManufacturer\"),\n                    \"via_device\":                   global.get(\"deviceViaDevice\"),\n                    \"identifiers\":                  msg.thing.hass.UID_ha,\n                    \"name\":                         msg.thing.hass.label,\n                    \"model\":                        global.get(\"deviceModel\"),\n                    \"sw_version\":                   global.get(\"deviceSWVersion\"),\n                    },\n                \"entity_category\":                  \"diagnostic\",\n                \"state_topic\":                     \"smarthome/items/\"+i+\"_status/state\",\n                \"value_template\":                  \"{{ value_json.value }}\"\n}\nmsg.type = \"entity\"\nnode.send(msg)\n\ndiscoveryBaseTopic = global.get(\"mqttDiscoveryTopic\") + \"/select/\" + msg.thing.hass.UID_ha + \"/device_mode\"\nmsg.topic = discoveryBaseTopic + \"/config\"\nmsg.payload =   {\n                \"name\":                             msg.thing.label + \" Heat Source Select\",\n                \"object_id\":                        global.get(\"namePrecursor\") + msg.thing.label + \" Heat Source Select\",\n                \"unique_id\":                        i + \"_heat_source_select\",\n                \"enabled_by_default\":               \"true\",\n                \"availability\":                     {\n                                                    \t\"topic\":                    msg.thing.hass.availabilityTopic,\n                                                    \t\"payload_available\":        \"online\",\n                                                    \t\"payload_not_available\":    \"offline\",\n                                                    \t\"value_template\":           \"{{ value_json.status }}\", \n                                                    },\n                \"device\": {\n                    \"manufacturer\":                 global.get(\"deviceManufacturer\"),\n                    \"via_device\":                   global.get(\"deviceViaDevice\"),\n                    \"identifiers\":                  msg.thing.hass.UID_ha,\n                    \"name\":                         msg.thing.hass.label,\n                    \"model\":                        global.get(\"deviceModel\"),\n                    \"sw_version\":                   global.get(\"deviceSWVersion\"),\n                    },\n                \"entity_category\":                  \"diagnostic\",\n                \"state_topic\":                      \"smarthome/items/\"+i+\"_heat-source/state\",\n                \"command_topic\":                    \"smarthome/items/\"+i+\"_heat-source/set\",\n                \"options\":                          [\n                                                        \"Prefer Heatpump\", \n            \t                                        \"Prefer Gas\"\n            \t                                    ],\n}\nmsg.type = \"entity\"\nnode.send(msg)\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 540,
        "wires": [
            [
                "6fc28ef47b87f702"
            ]
        ]
    },
    {
        "id": "0fb7b59456f85d4b",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Pre-Process Channels",
        "func": "function capitolizeFirst(string) {\n var output = string.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n return output;\n}\nvar msg1 = {}\nmsg1.debug = {}\nvar channel = {}\n\nchannelRaw =                msg.payload\n//msg.payload =               {}\nchannelUID =                channelRaw.uid.replace(\"idsmyrv:\",\"\")\nchannelUID =                channelUID.replace(\"-thing:\",\"_\")\nchannelUID =                channelUID.replace(/-/g,\"_\")\nchannelTypeUID =            channelRaw.channelTypeUID.replace(\"idsmyrv:\",\"\")\nchannelUID_ha =             channelRaw.uid.replace(/:/g,\"_\")\nchannelUID_ha =             channelUID_ha.replace(/-/g,\"_\")\n\nmsg.payload.hass = {}\n\nmsg.payload.hass = {\n    \"label_ha\":                     msg.thing.hass.label + \" \" + capitolizeFirst(channelRaw.id),\n    \"channelUID_oc\":                channelRaw.uid,\n    \"channelUID_ha\":                channelUID_ha,\n    \"id_oc\":                        channelRaw.id,\n    \"valueType_oc\":                 channelRaw.itemType.toLowerCase(),\n    \"channelType_ha\":               msg.thing.hass.thingTypeUID_ha +\":\"+channelRaw.id,\n    \"kind\":                         channelRaw.kind.toLowerCase(),\n    \"topicItemStateEvent\":          \"smarthome/items/\" + channelUID_ha + \"/state\",\n    \"topicThingStatusInfoEvent\":    \"smarthome/things/\" + msg.thing.UID + \"/status\",\n    \"topicItemStateChangedEvent\":   \"smarthome/items/\" + channelUID_ha + \"/statechanged\",\n    \"topicItemCommandEvent\":        \"smarthome/items/\" + channelUID_ha + \"/command\",\n    \"topicItemCommandSend\":         \"smarthome/items/\" + channelUID_ha + \"/set\"\n                            }  \n\n// Build base discovery content \n\n\nbasePayload =                       {\"name\":                    msg.payload.hass.label_ha,\n                                    \"object_id\":                global.get(\"namePrecursor\") + msg.payload.hass.label_ha,\n                                    \"unique_id\":                msg.payload.hass.channelUID_ha,\n                                    \"state_topic\":              msg.payload.hass.topicItemStateEvent,\n                                    \"value_template\":           \"{{ value_json.value }}\", \n                                    \"availability\": {\n                                    \t\"topic\":                    msg.thing.hass.availabilityTopic,\n                                    \t\"payload_available\":        msg.thing.hass.availabilityTopicOn,\n                                    \t\"payload_not_available\":    msg.thing.hass.availabilityTopicOff,\n                                    \t\"value_template\":           \"{{ value_json.\" + msg.thing.hass.availabilityTopicAttr + \" }}\", \n                                        },\n                                    \"device\": {\n                                        \"manufacturer\":         global.get(\"deviceManufacturer\"),\n                                        \"via_device\":           global.get(\"deviceViaDevice\"),\n                                        \"identifiers\":          msg.thing.hass.UID_ha,\n                                        \"name\":                 msg.thing.hass.label,\n                                        //\"connections\":          [[\"mac\", msg.thing.configuration.mac],[\"foo\",\"bar\"]],\n                                        \"model\":                global.get(\"deviceModel\") + \": \" + msg.thing.hass.UID_ha,\n                                        \"sw_version\":           global.get(\"deviceSWVersion\")\n                                        }\n    }\n\n\n//var channel = {} // Used to add entity-specific attributes to the payload\n\n//Set generic entity types based on OpenHab channel itemTypes \nswitch(msg.payload.hass.channelType_ha){\n    case \"light:dimmer\":\n        msg.payload.hass.entityType_ha = \"light\"\n        break;\n    case \"switched-light:switch\":\n        msg.payload.hass.entityType_ha = \"light\"\n        break;\n    default:\n        msg.payload.hass.entityType_ha = \"sensor\"\n        break;\n}\n\nmsg.payload.hass.discovery = {}\nmsg.payload.hass.attributes = {}\nmsg.payload.hass.discovery.payload = basePayload\nmsg.payload.hass.attributes.payload = msg.thing.configuration\nreturn [msg,msg]\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 260,
        "wires": [
            [],
            [
                "02c44407100b5dfe"
            ]
        ]
    },
    {
        "id": "02c44407100b5dfe",
        "type": "switch",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Exclude Special Devices",
        "property": "thing.hass.thingTypeUID_ha",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "rgb-light",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 300,
        "wires": [
            [],
            [
                "25ecfdaf34edb547"
            ]
        ]
    },
    {
        "id": "25ecfdaf34edb547",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "11cee4e8082393f2",
        "name": "Process Individual Channels",
        "func": "addPayload = {}\n\nif (msg.payload.hass.channelType_ha.includes(\":\") === true ) {\n    channel = msg.payload.hass.channelType_ha.split(\":\")\n    channelType = channel[1]\n} else {\n    channel = msg.payload.hass.channelType_ha\n}\n\ndiscoveryPayload = msg.payload.hass.discovery.payload\n\n// Add device additional details as needed based on channel types\nif (channelType.includes(\"voltage\") === true ) {\n        addPayload = {\n            \"device_class\":                 \"voltage\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"current\") === true ) {\n        addPayload = {\n            \"device_class\":                 \"current\",\n            \"unit_of_measurement\":          \"A\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"dimmer\") === true ) {\n        baseTopic_oc = \"smarthome/items/\" + msg.payload.hass.channelUID_ha\n        baseName = msg.thing.hass.UID_oc.replace(/:/g,\"_\")\n        baseName = \"smarthome/items/\" + baseName.replace(/-/,\"_\")\n        delete msg.payload.hass.discovery.payload.value_template\n        \n        addPayload = {\n            \"state_topic\":                  baseName + \"_switch/state\",\n            \"command_topic\":                baseTopic_oc + \"/set\",\n            \"brightness_state_topic\":       baseName + \"_brightness/state\",\n            \"brightness_command_topic\":     baseTopic_oc + \"/set\",\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"brightness_scale\":             100,\n            \"on_command_type\":              \"last\",\n            \"qos\":                          0,\n            \"effect_state_topic\":           baseName + \"_mode/state\",\n            \"effect_command_topic\":         baseName + \"_mode/set\",\n            \"effect_list\":                  [\"Off\",\"Dimmer\",\"Blink\",\"Swell\"],\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"fault\") === true) {\n        msg.payload.hass.entityType_ha = \"binary_sensor\"\n        addPayload = {\n            \"device_class\":                 \"problem\",\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"entity_category\":              \"diagnostic\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\n\nif (msg.payload.hass.channelType_ha.includes(\"generator:command\") === true) {\n        msg.payload.hass.entityType_ha =    \"switch\"\n        msg.payload.hass.discovery.payload.name = \"Generator Switch\"\n        msg.payload.hass.discovery.payload.object_id = global.get(\"namePrecursor\") + msg.payload.hass.discovery.payload.name\n        addPayload = {\n            \"command_topic\":                msg.payload.hass.topicItemCommandSend,\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"state_on\":                     \"on\",\n            \"state_off\":                    \"off\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"output-disable\") === true) {\n        msg.payload.hass.entityType_ha = \"sensor\"\n        addPayload = {\n            \"entity_category\":              \"diagnostic\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\n\nif (channelType.includes(\"online\") === true ) {\n        msg.payload.hass.entityType_ha =        \"binary_sensor\"\n        addPayload = {\n            \"device_class\":                 \"connectivity\",\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"entity_category\":              \"diagnostic\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n    \nif (channelType.includes(\"output-disable-cause\") === true ) {\n        addPayload = {\n            \"entity_category\":              \"diagnostic\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n    \nif (channelType.includes(\"percent\") === true ) {\n    if (msg.payload.hass.id_oc == \"position\") {\n            addPayload = {\n                \"unit_of_measurement\":          '%',\n                \"value_template\":               '{{ (((value_json |float)/255)*100)|round(0) }}',\n                \"enabled_by_default\":           \"true\"\n                }\n            } else {\n                addPayload = {\n                \"enabled_by_default\":           \"true\"\n                }\n            }\n    }\n\nif (channelType.includes(\"sleep\") === true) {\n        msg.payload.hass.entityType_ha =        \"number\"\n        addPayload = {\n            \"command_topic\":                msg.payload.hass.topicItemCommandSend,\n            \"qos\":                          0,\n            \"unit_of_measurement\":          \"mins.\",\n            \"step\":                         1,\n            \"min\":                          0,\n            \"max\":                          120,\n            \"icon\":                         \"mdi:timer\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"switch\") === true &&\n    channelType.includes(\"switched-light\") != true) {\n        msg.payload.hass.entityType_ha =    \"switch\"\n        addPayload = {\n            \"command_topic\":                msg.payload.hass.topicItemCommandSend,\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"state_on\":                     \"on\",\n            \"state_off\":                    \"off\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n\nif (channelType.includes(\"switched-light\") === true) {\n        msg.payload.hass.entityType_ha =        \"light\"\n        addPayload = {\n            \"command_topic\":                msg.payload.hass.topicItemCommandSend,\n            \"payload_on\":                   \"on\",\n            \"payload_off\":                  \"off\",\n            \"state_on\":                     \"on\",\n            \"state_off\":                    \"off\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n    \nif (channelType.includes(\"tank-level\") === true ) {\n        addPayload = {\n            \"icon\":                         \"mdi:water-percent\",\n            \"unit_of_measurement\":          \"%\",\n            \"enabled_by_default\":           \"true\"\n                }\n    }\n\n\nif (channelType.includes(\"temperature\") === true && \n    channelType.includes(\"temperature-setpoints\") === false) {\n        addPayload = {\n            \"device_class\":                 \"temperature\",\n            \"unit_of_measurement\":          \"Â°F\",\n            \"enabled_by_default\":           \"true\"\n            }\n    }\n    \nif (channelType.includes(\"temperature-setpoints\") === true) {\n        addPayload = {\n            \"enabled_by_default\":           \"false\"\n            }\n    }\n    \n// These sensors are unknown in their purpose, so we create them, but do not enable them unless we want to.\nif (channelType.includes(\"time1\") === true || channelType.includes(\"time2\") === true ) {\n        addPayload = {\n            \"enabled_by_default\":           \"false\"\n                }\n    }\n\n    \ndiscoveryBaseTopic = global.get(\"mqttDiscoveryTopic\") + \"/\" + msg.payload.hass.entityType_ha + \"/\" + msg.thing.hass.UID_ha + \"/\" + msg.payload.hass.id_oc\nmsg.payload.hass.discovery.topic = discoveryBaseTopic + \"/config\"\nmsg.payload.hass.attributes.topic = discoveryBaseTopic + \"/attributes\"\nmsg.payload.hass.discovery.payload = {...discoveryPayload,...addPayload }\n\nmsg1 = {}\nmsg1.topic = msg.payload.hass.discovery.topic\nmsg1.payload = msg.payload.hass.discovery.payload\nmsg1.type = \"entity\"\nreturn [msg1,msg];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 340,
        "wires": [
            [
                "2246a7b0e41df251",
                "eedd8594c925dbf3"
            ],
            [
                "1baacf69c1df92ac"
            ]
        ]
    },
    {
        "id": "d445b1bb9cd4ab81",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "4514be5227808dc1",
        "name": "Custom Sensors and Tools",
        "func": "// ####################### Begin Online Status Details sensor #######################\n// OneControl provides additional information in the availability messages published, and this informaion\n//   is very useful in diagnosing potential connection issues.\n// This sensor displays any additional status details if there are any to report\nmsg1 = {}\nname = msg.thing.label + \" Online Status Details\"\nproperty = \"online_status_details\"\nbaseTopic  =  global.get(\"mqttDiscoveryTopic\") + \"/sensor/\" + msg.thing.hass.UID_ha + \"/\" + property\nmsg1.topic =  baseTopic + \"/config\"\n\nmsg1.payload = {\n    \"name\":                 name,\n    \"object_id\":            global.get(\"namePrecursor\") + name,\n    \"unique_id\":            msg.thing.hass.UID_ha + \" \" + property,\n    \"entity_category\":      \"diagnostic\",\n    \"state_topic\":          msg.thing.hass.availabilityTopic,\n    \"value_template\":       \"{{ value_json.statusDetail }}\",\n    \"availability\":         {\"topic\":                      msg.thing.hass.availabilityTopic,\n                            \t\"payload_available\":        msg.thing.hass.availabilityTopicOn,\n                            \t\"payload_not_available\":    msg.thing.hass.availabilityTopicOff,\n                            \t\"value_template\":           \"{{ value_json.\" + msg.thing.hass.availabilityTopicAttr + \" }}\", \n                                },\n    \"device\":                {\"manufacturer\":       global.get(\"deviceManufacturer\"), \n                                \"via_device\":       global.get(\"deviceViaDevice\"),\n                                \"identifiers\":      msg.thing.hass.UID_ha, \n                                \"name\":             msg.thing.label, \n                                \"model\":            global.get(\"deviceModel\") + \": \" + msg.thing.hass.UID_ha,\n                                \"sw_version\":       global.get(\"deviceSWVersion\")\n                                },\n    \"enabled_by_default\":   true\n    } \nmsg1.type = \"entity\"\nnode.send(msg1)\n// ####################### End Online Status Details sensor #######################\n\nreturn[null,msg]\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 600,
        "wires": [
            [
                "eedd8594c925dbf3"
            ],
            [
                "7c688006afafe03e"
            ]
        ]
    },
    {
        "id": "66b533eb7bb555b6",
        "type": "catch",
        "z": "c5bf60a40630c5e3",
        "g": "4979df7953c906ee",
        "name": "Capture Errors",
        "scope": null,
        "uncaught": false,
        "x": 720,
        "y": 200,
        "wires": [
            [
                "879a7280e4ff88f2"
            ]
        ]
    },
    {
        "id": "879a7280e4ff88f2",
        "type": "debug",
        "z": "c5bf60a40630c5e3",
        "g": "4979df7953c906ee",
        "name": "Errors - Full Payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 260,
        "wires": []
    },
    {
        "id": "6fc28ef47b87f702",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "Value Cleanup",
        "func": "function capitolizeFirst(string) {\n var output = string.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n return output;\n}\nif (msg.type == \"entity\") {\n    if (typeof msg.payload.name !== 'undefined') {\n        if (msg.payload.name.includes(\"-\") === true ){\n            msg.payload.name = msg.payload.name.replace(\"-\",\" \")\n             msg.payload.name = capitolizeFirst(msg.payload.name)\n        }\n    }\n}\n\nif (global.get(\"mqttPublish\") == true) {\n    if (global.get(\"mqttDeleteAll\") == true) {\n        msg.payload = null\n        msg.retain = true\n        msg.qos=  1\n        }\n    if (global.get(\"mqttRetain\") == true) {\n        msg.retain = true\n        }\n    switch(msg.type) { \n        case \"entity\":\n            if (global.get(\"mqttRecordsOnly\") == false) {\n                node.send(msg)\n                } \n            break;\n        default:\n            node.send(msg)\n            break;\n        }\n}\n// ############################## Write out entities to file if enabled #####################\nmsg1 = msg\nif(msg1.topic.includes(\"/config\") === true &&\n    global.get(\"filesCreate\") === true && \n    msg1.type == \"entity\") {\n        i = msg1.topic.split(\"/\")\n        name = msg1.payload.object_id.replace(/ /g,\"_\")\n        msg1.filename = global.get(\"filesSaveTo\") + msg1.payload.device.name + \"/\" + i[1] + \"/\" + msg1.payload.name\n        if (global.get(\"filesNoDiscovery\") == true) {\n            delete msg1.payload.device\n            delete msg1.payload.enabled_by_default\n            }\n        return [null,msg1];\n        }\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 340,
        "wires": [
            [],
            [
                "99f937e3894a08b8",
                "273da8d4173943bb"
            ]
        ]
    },
    {
        "id": "e0aac92236e32259",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "6858fb2384f7f246",
        "name": "Process Configuration",
        "func": "/**\n OneControl Auto Discovery into Home Assistant\n \n This process will integrate your Lippert OneControl components into Home Assistance\n\t(http://www.home-assistant.io)\n \n Use this file to set the bahavior of the process of pulling devices from the OneControl system\n*/\n\n\n// You can use this tool for many purposes, and if you are conservative in your approach, you would like to review \n//   the code before connecting it to your environment.\n// By default, the monitoring flow connects to the OneControl cloud gateway as soon as the flow is deployed.  This ensures\n//   that every time a change is made and deployed the connection to the event feed is re-established automatically.  A trigger\n//   node is available for manually kicking off the connection for manual control.\n//     default:\n//          eventsGetStream = true\neventsGetStream = true;\n\n// As this tool starts, it subscribes to the MQTT topics that are used for the processing of commands and events, \n//   and if a command is meant to be sent to OneControl, it will do so automatically.  If you are working to troubleshoot \n//   or review what is happening before sending it to OneControl, you will likely want to prevent this from occuring until you\n//   prepared for it to be done.\n// Note: This will disable the actual transmission to OneControl, but NOT the event processing.  This will allow you to see what would\n//   be sent if/once it is enabled.\n//     default:\n//          eventsSendStream = true\neventsSendStream = true;\n\n\n// When the information is pulled from the OneControl system, you have the option to write the information\n//   to files on the local system, as both YAML and JSON.  These can be used to help troubleshoot, or you can \n//   us the YAML output as the config files for Home Assistant. Set to \"true\" to have the output files written\n//   to disk.  If files exist, they will be overwritten.\n// ** NOTE ** These files are NOT needed for this process to work, and are for troubleshooting/stand alone use.\n//     default:\n//          filesCreate = false\nfilesCreate = true;\n\n// This is where you define the destination for the files if you are using the tool \n//     default: \n//          filesSaveTo = '/config/OneControl/'\nfilesSaveTo = '/config/OneControl/';\n\n// When files are saved, they are saved as YAML and JSON, but include the attributes needed for Discovery, and\n//   cannot be used for static YAML configuration without certain sections removed. Set this to true to remove\n//   the discovery-related sections.\n// ** NOTE ** \n// You will still need to use the \"OneControl - Command and Event Stream\" flow to process events to align with the \n//   MQTT topics that are part of the configuration files\n//     default:\n//          filesNoDiscovery = false\nfilesNoDiscovery = false;\n\n// Often when you make changes, you may need to remove all the entities created.\n//   This option will enable the process to remove all entities created in previous\n//   run AS LONG AS NO OTHER SETTINGS HAVE CHANGED (this depends on the deiscovery\n//   topic to be the same).\n//   Note: sendToMQTT must also be enabled\n//     default:\n//          mqttDeleteAll = false;\nmqttDeleteAll = false;\n\n// Home Assistant requires the definition of the topic used for discovery.  \n// For more info on what is needed, review the Home Assistant documentation here:\n//    https://www.home-assistant.io/docs/mqtt/discovery/\n// This value needs to match what is entered into your configuration.yaml file\n// configuration.yaml example:\n//     mqtt:\n//          discovery:          true\n//          discovery_prefix:   'homeassistant'\n//\n//     default:\n//          mqttDiscoveryTopic = 'homeassistant'\nmqttDiscoveryTopic = 'homeassistant';\n\n// When you initially create the entities in Home Assistant, it can take a long\n//   time before an availability message is published from OneControl, sometimes \n//   upwards of 30 minutes.  This is because OneControl publishes changes in real\n//   time, but non-change status messages much less frequently.  This can be frustrating\n//   when initially creating the entities.\n// Enable this setting to generate an \"online\" message when you do the initial \n//   installation, which will show the entitied as \"online\" immediately.  If the\n//   entities are truly offline, you will not be able to run the discovery process\n//   without an error, so enabling this is low (but not no) risk.  Please note\n//   that this will only occur once at the time the discovery process is run.\n// If you enable this, the device's \"Online Status Details\" sensor value will be\n//   'Initial Discovery' until OneControl publishes an official message.  It is not uncommon\n//   to see the online entity listed as \"Disconnected\" until this first message is received.\n//     default: \n//          mqttInitialAvail = true\nmqttInitialAvail = true;\n\n// When you initially create the entities in Home Assistant, it can take a long\n//   time before a state update is published, marking the Home Assistant entity with\n//   the value of \"Unknown\".  This setting enables a flow that will connect to OneControl\n//   and get the current state and populate it right away.\n//     default: \n//          mqttInitialState = true\nmqttInitialState = true;\n\n// If you do not want to send the configuration to the MQTT server, set this to \"false\"\n//     default: \n//          mqttPublish = false\nmqttPublish = true;\n\n// If you want to run this script to only generate the availability records as well as the diagnostic info,\n//   set this to true.  This is helpful if you need to publish availability info to activate entities that\n//   are still in an unknown state\n//     default: \n//          mqttRecordsOnly = false\nmqttRecordsOnly = false;\n\n// If you want to have MQTT discovery messages retained between restarts, set this option to \"true\"\n// If you do not set this to true, your Home Assistant OneControl entities will be in an error state until you\n//   run the discovery script again.  This is due to how Home Assistant stores entity information.\n//     default: \n//          mqttRetain = true\nmqttRetain = true;\n\n// Part of the discovery output is the definition of the manufacturer the component.\n//     default: \n//          deviceManufacturer = 'Lippert Components'\ndeviceManufacturer = 'Lippert Components';\n\n// Part of the discovery output is the definition of the device that is used to \n//   connect to the individual nodes.\n//     default:\n//          deviceViaDevice = 'OneControl Gateway';\ndeviceViaDevice = 'OneControl Gateway';\n\n// Part of the discovery output is the definition of the model the component.\n//     default:\n//          model = 'OneControl';\nmodel = 'OneControl';\n\n// when the Home Assistant entity is created, you can prepend this string to the\n//   entityID: 'sensor.example' would become 'sensor.namePresursor_example'\n//     default:\n//          namePrecursor= 'OneControl '\nnamePrecursor = 'OneControl ';\n\n\n\n/* ############ Do not change anything below this line ############ */\nRelease_Version = '2022.01.18a'\n\nglobal.set(\"eventsGetStream\",eventsGetStream);\nglobal.set(\"eventsSendStream\",eventsSendStream);\n\nglobal.set(\"filesCreate\",filesCreate);\nglobal.set(\"filesSaveTo\",filesSaveTo);\nglobal.set(\"filesNoDiscovery\",filesNoDiscovery);\n\nglobal.set(\"mqttDeleteAll\",mqttDeleteAll);\nglobal.set(\"mqttDiscoveryTopic\",mqttDiscoveryTopic);\nglobal.set(\"mqttInitialAvail\",mqttInitialAvail);\nglobal.set(\"mqttInitialState\",mqttInitialState);\nglobal.set(\"mqttPublish\",mqttPublish);\nglobal.set(\"mqttRecordsOnly\",mqttRecordsOnly);\nglobal.set(\"mqttRetain\",mqttRetain);\n\n\n\nglobal.set(\"deviceManufacturer\",deviceManufacturer);\nglobal.set(\"deviceSWVersion\",Release_Version);\n\nglobal.set(\"deviceViaDevice\",deviceViaDevice);\nglobal.set(\"deviceModel\",model);\nglobal.set(\"namePrecursor\",namePrecursor);\n\n\nreturn msg;\n/*\n * Copyright Robert Perciaccante\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n**/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 120,
        "wires": [
            [
                "aa1ffe397c27678d"
            ]
        ]
    },
    {
        "id": "a80200c65e78f34a",
        "type": "inject",
        "z": "c5bf60a40630c5e3",
        "g": "6858fb2384f7f246",
        "name": "Load Config",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 1070,
        "y": 120,
        "wires": [
            [
                "e0aac92236e32259"
            ]
        ]
    },
    {
        "id": "aa1ffe397c27678d",
        "type": "debug",
        "z": "c5bf60a40630c5e3",
        "g": "6858fb2384f7f246",
        "name": "Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 120,
        "wires": []
    },
    {
        "id": "888e1201759d2203",
        "type": "debug",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 480,
        "wires": []
    },
    {
        "id": "273da8d4173943bb",
        "type": "yaml",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "property": "payload",
        "name": "",
        "x": 1230,
        "y": 360,
        "wires": [
            [
                "dffd7703ab060e9f"
            ]
        ]
    },
    {
        "id": "11af832c02c64601",
        "type": "file",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "",
        "filename": "",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1440,
        "y": 440,
        "wires": [
            [
                "888e1201759d2203"
            ]
        ]
    },
    {
        "id": "9be463bbf9a8f997",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "JSON Filename",
        "func": "msg.filename = msg.filename +\".json\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 400,
        "wires": [
            [
                "11af832c02c64601"
            ]
        ]
    },
    {
        "id": "99f937e3894a08b8",
        "type": "json",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 1230,
        "y": 400,
        "wires": [
            [
                "9be463bbf9a8f997"
            ]
        ]
    },
    {
        "id": "dffd7703ab060e9f",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "YAML Filename",
        "func": "msg.filename = msg.filename +\".yaml\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 360,
        "wires": [
            [
                "11af832c02c64601"
            ]
        ]
    },
    {
        "id": "6a2e6e770864cdd0",
        "type": "debug",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 320,
        "wires": []
    },
    {
        "id": "f11ec4beb8586b8f",
        "type": "mqtt out",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "4410210f.6939c",
        "x": 1390,
        "y": 280,
        "wires": []
    },
    {
        "id": "3e2a20b42543032b",
        "type": "comment",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "Data Publishing",
        "info": "",
        "x": 1240,
        "y": 220,
        "wires": []
    },
    {
        "id": "45a56438708b01c9",
        "type": "comment",
        "z": "c5bf60a40630c5e3",
        "g": "6858fb2384f7f246",
        "name": "Load Configuration Options for Process",
        "info": "",
        "x": 1230,
        "y": 60,
        "wires": []
    },
    {
        "id": "98f4ba26adf91fe6",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "09ec6382357415d1",
        "name": "Normalize Node Records",
        "func": "var msg1 = {}\n\nmsg1.payload = {}\n/* Loop through incoming payload to rename the individual things so they can be better processed later */\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    var thing = {}\n    \n    thingTypeUID = msg.payload[i].thingTypeUID.replace(\"idsmyrv:\",\"\")\n    thingTypeUID = thingTypeUID.replace(\"-thing\",\"\")\n    \n    thingUID = msg.payload[i].UID.replace(\"-thing:\",\"_\")\n    thingUID = thingUID.replace(\"idsmyrv:\",\"\")\n    thingUID = thingUID.replace(/:/g,\"_\")\n    thingUID = thingUID.replace(/-/g,\"_\")\n    \n    /*\n    // This uses the _online channel as source of availability\n    availTopic =        msg.payload[i].UID.replace(/:/g,\"_\")\n    availTopic =        availTopic.replace(/-/g,\"_\") + \"_online\"\n    availTopic =        \"smarthome/items/\" + availTopic + \"/state\"\n    availTopicOn =      \"on\"\n    availTopicOff =     \"off\"\n    availAttr =         \"value\"\n    */\n    \n    // This uses the device online state for availability\n    availTopic =        \"smarthome/things/\" + msg.payload[i].UID + \"/status\"\n    availTopicOn =      \"online\"\n    availTopicOff =     \"offline\"\n    availAttr =         \"status\"\n    \n    \n    label = msg.payload[i].label.replace(\" Thing\",\"\")\n    label = label.replace(\"OneControl \",\"\")\n\n    //thing.hass = {}\n    msg1.thing  =                   msg.payload[i]\n    msg1.thing.hass =                {\"label\":                  label,\n                                    \"thingConfig_OC\":           msg.payload[i].configuration,\n                                    \"UID_oc\":                   msg.payload[i].UID,\n                                    \"UID_ha\":                   thingUID,\n                                    \"thingTypeUID_oc\":          msg.payload[i].thingTypeUID,\n                                    \"thingTypeUID_ha\":          thingTypeUID,\n                                    \"thingChannelCount\":        msg.payload[i].channels.length,\n                                    \"availabilityTopic\":        availTopic,\n                                    \"availabilityTopicOn\":      availTopicOn,\n                                    \"availabilityTopicOff\":     availTopicOff,\n                                    \"availabilityTopicAttr\":    availAttr,\n                                    \"stateTopic\":               global.get(\"mqttDiscoveryTopic\") +\"/binary_sensor/\" + thingUID + \"/status\"\n                                }\n    \n    msg1.payload = msg.payload[i].channels\n    /* Send each thing record as a new message to split up the array and process the things individually */\n    \n    node.send(msg1)\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 120,
        "wires": [
            [
                "f5a3506e1a122e6b",
                "8efc57e27bef52e5"
            ]
        ]
    },
    {
        "id": "4a241eecd05a027a",
        "type": "delay",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "Delay 1/2 sec",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1240,
        "y": 300,
        "wires": [
            [
                "6a2e6e770864cdd0",
                "f11ec4beb8586b8f"
            ]
        ]
    },
    {
        "id": "4efa180cc4812cc4",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "4514be5227808dc1",
        "name": "Set Initial Availability (If enabled)",
        "func": " \n// ####################### Begin Startup Availability Message Publishing #######################\n// This section is used by the 'startupAvailMsg' option.  When this is set to true, this code will\n//   send a dummy available payload to trigger the availability for the entities created in this tool.\n if (global.get(\"mqttInitialAvail\") === true) {\n        msg1 = {}\n        msg1.payload = '{\"status\":\"' + msg.thing.hass.availabilityTopicOn + '\",\"statusDetail\":\"Initial Discovery\"}'\n        msg1.topic = msg.thing.hass.availabilityTopic\n        msg1.retain = true\n        msg1.qos = 1\n        msg1.type = \"record\"\n    \n    }\n// ####################### End Startup Availability Message Publishing #######################\nreturn [msg1,msg]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 680,
        "wires": [
            [
                "eedd8594c925dbf3"
            ],
            []
        ]
    },
    {
        "id": "7c688006afafe03e",
        "type": "delay",
        "z": "c5bf60a40630c5e3",
        "g": "4514be5227808dc1",
        "name": "Meter message rate",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 440,
        "y": 640,
        "wires": [
            [
                "4efa180cc4812cc4"
            ]
        ]
    },
    {
        "id": "ef9ad8391578af6e",
        "type": "http request",
        "z": "c5bf60a40630c5e3",
        "g": "09ec6382357415d1",
        "name": "Get OneControl Components",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.1.4:8080/rest/things/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 390,
        "y": 80,
        "wires": [
            [
                "98f4ba26adf91fe6"
            ]
        ]
    },
    {
        "id": "2246a7b0e41df251",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "90c01626219c9b6e",
        "name": "Build State URL",
        "func": "if (global.get(\"mqttInitialState\") == true && \n    global.get(\"mqttDeleteAll\") !== true) {\n    msg1 = {}\n    msg1.url = \"http://192.168.1.4:8080/rest/items/\" + msg.payload.unique_id\n    return msg1\n    }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 360,
        "wires": [
            [
                "5534c824af950556"
            ]
        ]
    },
    {
        "id": "5534c824af950556",
        "type": "http request",
        "z": "c5bf60a40630c5e3",
        "g": "90c01626219c9b6e",
        "name": "Get Entity State",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": true,
        "x": 800,
        "y": 400,
        "wires": [
            [
                "ddd5b4ca9b2214d1"
            ]
        ]
    },
    {
        "id": "ddd5b4ca9b2214d1",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "90c01626219c9b6e",
        "name": "Process Results",
        "func": "msg1 = {}\n\nfunction capitolizeFirst(string) {\n var output = string.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n return output;\n}\n\nfunction roundNum1(i) {\n    i = Number(i)\n    i = i.toFixed(1)\n    i = Number(i)\n    return i\n}\n\nif (msg.statusCode == \"200\") {\n    msg1 = {}\n    if (isNaN(parseInt(msg.payload.state)) == true) {\n            msg1.payload = {\"value\": msg.payload.state.toLowerCase()}\n        } else {\n            msg1.payload = {\"value\": roundNum1(parseFloat(msg.payload.state))}\n        }    \n    msg1.topic = \"smarthome/items/\" + msg.payload.name + \"/state\"\n    return msg1;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 440,
        "wires": [
            [
                "6fc28ef47b87f702"
            ]
        ]
    },
    {
        "id": "8efc57e27bef52e5",
        "type": "function",
        "z": "c5bf60a40630c5e3",
        "g": "b07fe501c3da07e1",
        "name": "Create HA Control Entities",
        "func": "msg1 = {}\n\nmqttCommon = {\n    \"device\":{\n\t\t\"manufacturer\":\t\"Bob Perciaccante - bob@perciaccante.net\",\n\t\t\"configuration_url\":    \"https://github.com/rperciaccante/HomeAssistant_OneControl_Discovery\",\n\t\t\"via_device\":\t\"Home Assistant MQTT\",\n\t\t\"identifiers\":\t\"Home Assistant OneControl Integration\",\n\t\t//\"model\":        \"https://github.com/rperciaccante/HomeAssistant_OneControl_Discovery\",\n\t\t\"name\":\t\t\t\"Home Assistant OneControl Integration Components\"\n        },\n   \"enabled_by_default\":\"true\",\n   \"retain\":            \"true\",\n   \"qos\":               1\n    }\n\n// ####################### Begin Event Restart Button Configuration #######################\n// Create a button in Home Assistant that can be used to restart the event flow in the \n//   event that is needed\nmsg1.payload = {\n\t\"name\":\t\t\t\t\"OneControl Event Restart\",\n\t\"object_id\":\t\t\"OneControl Event Restart\",\n\t\"unique_id\":\t\t\"OneControl Event Restart\",\n\t\"command_topic\":    \"onecontrol/homeassistant/eventsRestartStream/set\"\n    }\nmsg1.payload = {...msg1.payload,...mqttCommon}\n\nmsg1.topic = \"homeassistant/button/onecontrolintegration/eventrestart/config\"\nmsg1.type =  \"entity\"\nnode.send(msg1)\n// ####################### End Event Restart Button Configuration #######################\n\n// ####################### Begin Run Discovery Button Configuration #######################\n// Create a button in Home Assistant that can be used to run the discovery process in the \n//   event that is needed\nmsg1.payload = {\n\t\"name\":\t\t\t\t\"Run OneControl Discovery\",\n\t\"object_id\":\t\t\"Run OneControl Discovery\",\n\t\"unique_id\":\t\t\"Run OneControl Discovery\",\n\t\"command_topic\":    \"onecontrol/homeassistant/discoveryRun/set\"\n    }\nmsg1.payload = {...msg1.payload,...mqttCommon}\nmsg1.topic = \"homeassistant/button/onecontrolintegration/discoveryRun/config\"\nmsg1.type = \"entity\"\nnode.send(msg1)\n// ####################### End Run Discovery Button Configuration #######################\n\n\n// ####################### Begin Remove All Entities Button Configuration #######################\n// Create a button in Home Assistant that can be used to remove all entities created by the discovery\n//    process except the nodes used to manage the integration\nmsg1.payload = {\n\t\"name\":\t\t\t\t\"Remove All Entities\",\n\t\"object_id\":\t\t\"Remove All Entities\",\n\t\"unique_id\":\t\t\"Remove All Entities\",\n\t\"command_topic\":    \"onecontrol/homeassistant/mqttDeleteAll/set\"\n    }\nmsg1.payload = {...msg1.payload,...mqttCommon}\nmsg1.topic = \"homeassistant/button/onecontrolintegration/mqttDeleteAll/config\"\nmsg1.type = \"entity\"\nnode.send(msg1)\n// ####################### End Remove All Entities Button Configuration #######################\n\n// ####################### Begin Pull OneControl Events switch Configuration #######################\n// Create a switch in Home Assistant that can be used to enable or disable the processing of events from\n//   OneControl.\nmsg1.payload = {\n\t\"name\":\t\t\t\t\"Pull OneControl Events\",\n\t\"object_id\":\t\t\"Pull OneControl Events\",\n\t\"unique_id\":\t\t\"Pull OneControl Events\",\n\t\"command_topic\"     :   \"onecontrol/homeassistant/eventsGetStream/set\",\n\t\"state_topic\"       :   \"onecontrol/homeassistant/eventsGetStream/set\",\n\t\"payload_on\"        :   \"ON\",\n\t\"payload_off\"       :   \"OFF\",\n\t\"state_on\"        :   \"ON\",\n\t\"state_off\"       :   \"OFF\",\n\t\"device_class\"      :   \"switch\",\n\t\"icon\":             \"mdi:arrow-down-bold\"\n    }\nmsg1.payload = {...msg1.payload,...mqttCommon}\nmsg1.topic = \"homeassistant/switch/onecontrolintegration/eventsGetStream/config\"\nmsg1.type = \"entity\"\nnode.send(msg1)\n// ####################### End Pull OneControl Events switch Configuration #######################\n\n// ####################### Begin Push Home Assistant Events switch Configuration #######################\n// Create a switch that enables or disables the processing of events from Home Assistant up to Once Control\nmsg1.payload = {\n\t\"name\":\t\t\t\t\"Push Home Assistant Events\",\n\t\"object_id\":\t\t\"Push Home Assistant Events\",\n\t\"unique_id\":\t\t\"Push Home Assistant Events\",\n\t\"command_topic\"     :   \"onecontrol/homeassistant/eventsSendStream/set\",\n\t\"state_topic\"       :   \"onecontrol/homeassistant/eventsSendStream/set\",\n\t\"payload_on\"        :   \"ON\",\n\t\"payload_off\"       :   \"OFF\",\n\t\"state_on\"        :   \"ON\",\n\t\"state_off\"       :   \"OFF\",\n\t\"device_class\"      :   \"switch\",\n\t\"icon\":             \"mdi:arrow-up-bold\"\n    }\nmsg1.payload = {...msg1.payload,...mqttCommon}\nmsg1.topic = \"homeassistant/switch/onecontrolintegration/eventsSendStream/config\"\nmsg1.type = \"entity\"\nnode.send(msg1)\n// ####################### End Push Home Assistant Events switch Configuration #######################\n\n// ####################### Send current state of eventsSendStream to Home Assistant #######################\nif (global.get(\"eventsSendStream\") == false) {\n        msg1.payload = \"OFF\"\n    } else {\n        msg1.payload = \"ON\"\n    }\nmsg1.topic = \"onecontrol/homeassistant/eventsSendStream/set\"\nmsg1.type = \"record\"\nmsg1.retain = false\nnode.send(msg1)\n\n// ####################### Send current state of eventsGetStream to Home Assistant #######################\nif (global.get(\"eventsGetStream\") == false) {\n        msg1.payload = \"OFF\"\n    } else {\n        msg1.payload = \"ON\"\n    }\nmsg1.topic = \"onecontrol/homeassistant/eventsGetStream/set\"\nmsg1.type = \"record\"\nmsg1.retain = false\nnode.send(msg1)\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 100,
        "wires": [
            [
                "4a241eecd05a027a"
            ]
        ]
    },
    {
        "id": "489f1d4567f2e9fe",
        "type": "link in",
        "z": "c5bf60a40630c5e3",
        "name": "Trigger Dicovery",
        "links": [
            "9351ecadf4673a99",
            "0b7382dce12adcf8",
            "d6d1322b9d745884",
            "94ae0ec5e36d0e7b"
        ],
        "x": 55,
        "y": 100,
        "wires": [
            [
                "ef9ad8391578af6e"
            ]
        ]
    },
    {
        "id": "d25248e6a91d7fea",
        "type": "comment",
        "z": "c5bf60a40630c5e3",
        "g": "b07fe501c3da07e1",
        "name": "Important Notes",
        "info": "The control entities here are created at discovery but not removed during the Delete All process, so that the utilities can be run againfrom the HA interface.",
        "x": 770,
        "y": 60,
        "wires": []
    },
    {
        "id": "670878733f3ed1be",
        "type": "link in",
        "z": "c5bf60a40630c5e3",
        "g": "2ec83346dffc7d94",
        "name": "",
        "links": [
            "eedd8594c925dbf3"
        ],
        "x": 1025,
        "y": 440,
        "wires": [
            [
                "6fc28ef47b87f702"
            ]
        ]
    },
    {
        "id": "eedd8594c925dbf3",
        "type": "link out",
        "z": "c5bf60a40630c5e3",
        "name": "",
        "mode": "link",
        "links": [
            "670878733f3ed1be"
        ],
        "x": 635,
        "y": 620,
        "wires": []
    },
    {
        "id": "2f39f30d0b204f20",
        "type": "catch",
        "z": "43b59d10c7fbb603",
        "name": "Capture Errors",
        "scope": null,
        "uncaught": false,
        "x": 880,
        "y": 760,
        "wires": [
            [
                "8ee1264c58a23503"
            ]
        ]
    },
    {
        "id": "8ee1264c58a23503",
        "type": "debug",
        "z": "43b59d10c7fbb603",
        "name": "Errors - Full Payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1140,
        "y": 760,
        "wires": []
    },
    {
        "id": "8f14976b64bb3146",
        "type": "mqtt in",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "OneControl MQTT SET messages",
        "topic": "smarthome/items/+/set",
        "qos": "2",
        "datatype": "auto",
        "broker": "4410210f.6939c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 360,
        "wires": [
            [
                "5dfeec5f086a1a5d"
            ]
        ]
    },
    {
        "id": "391a9569a63dcb2a",
        "type": "http request",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "OneControl API Call",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 960,
        "y": 380,
        "wires": [
            [
                "2b59b7ebf7f8c64f"
            ]
        ]
    },
    {
        "id": "d798d4fbbc01f36d",
        "type": "debug",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "200 Success",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 340,
        "wires": []
    },
    {
        "id": "3e7e3125a5625d70",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "Format Outbound Message",
        "func": "function roundNum0(i) {\n    i = Number(i)\n    i = i.toFixed(0)\n    i = Number(i)\n    return i\n}\n\nvar msg1 = {}\n\nmsg1.item = msg.topic.split(\"/\")\nmsg1.foo = typeof(msg.payload)\nmsg1.headers = {\"Content-Type\": \"text/plain\", \"Accept\": \"application/json\"}\nif (typeof(msg.payload) == \"string\") {\n    msg1.payload = msg.payload.toUpperCase()\n}\n\nif (typeof(msg.payload) == \"number\") {\n    msg1.payload = roundNum0(msg.payload)\n}\nmsg1.url = \"http://192.168.1.4:8080/rest/items/\"+ msg1.item[2]\nreturn [msg,msg1];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 340,
        "wires": [
            [],
            [
                "391a9569a63dcb2a"
            ]
        ]
    },
    {
        "id": "f2bdd5e747c58fb2",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "Outbound Data Format Conversions *",
        "func": "function roundNum0(i) {\n    i = Number(i)\n    i = i.toFixed(0)\n    i = Number(i)\n    return i\n}\n\n// ***** Reformat hvac_mode.  Openhab uses \"heatcool\", and Home Assistant uses \"heat_cool\"\nif (msg.topic.includes(\"/idsmyrv_hvac_thing_\")  === true &&\n        msg.topic.includes(\"_hvac_mode/state\")  === true && \n        msg.payload.includes(\"heat_cool\")  === true){\n        msg.payload= \"heatcool\"\n        }\n\nif (msg.topic.includes(\"idsmyrv_hvac_thing_\")  === true &&\n        msg.topic.includes(\"_heat-source/state\")  === true ){ \n        switch(msg.payload) {\n            case \"Prefer Heatpump\":\n                msg.payload = \"HEATPUMP\"\n                break;\n            case \"Prefer Gas\":\n                msg.payload = \"GAS\"\n                break;\n            }\n        }\n      \n\n// ***** Remove trailing zero from temp setting\nif (msg.topic.includes(\"/idsmyrv_hvac_thing_\")  === true &&\n        msg.topic.includes(\"_temperature/set\")  === true ){\n    msg.payload= roundNum0(msg.payload)\n}\n\nreturn msg;\n/*\n\n\nsmarthome/items/idsmyrv_hvac_thing_0000000DA7271001_hvac_mode/state\n\n\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 380,
        "wires": [
            [
                "3e7e3125a5625d70"
            ]
        ],
        "info": "This node is used to translate between the two platforms.  In come cases, values need to be in upper case, some lower case, and some different vlaues entirely."
    },
    {
        "id": "2b59b7ebf7f8c64f",
        "type": "switch",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "HTTP Status Code",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1250,
        "y": 360,
        "wires": [
            [
                "d798d4fbbc01f36d"
            ],
            [
                "97ebd9ec3e8a6fde"
            ]
        ]
    },
    {
        "id": "97ebd9ec3e8a6fde",
        "type": "debug",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "Others",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 380,
        "wires": []
    },
    {
        "id": "948bd492828276bc",
        "type": "comment",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "This section connects to the local MQTT server and converts messages to commands and updates to OneControl",
        "info": "",
        "x": 810,
        "y": 280,
        "wires": []
    },
    {
        "id": "5dfeec5f086a1a5d",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "c2cef54b587f0bcb",
        "name": "Is Event Send enabled?",
        "func": "if (global.get(\"eventsSendStream\") == true ) {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 340,
        "wires": [
            [
                "f2bdd5e747c58fb2"
            ]
        ]
    },
    {
        "id": "285a06fd6b523577",
        "type": "mqtt in",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Home Assistant - Integration Commands",
        "topic": "onecontrol/homeassistant/+/set",
        "qos": "2",
        "datatype": "auto",
        "broker": "4410210f.6939c",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 220,
        "y": 560,
        "wires": [
            [
                "c5a20be305249658"
            ]
        ]
    },
    {
        "id": "c5a20be305249658",
        "type": "switch",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Sort by Event action",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "eventsGetStream",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "eventsSendStream",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "mqttDeleteAll",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "eventsRestartStream",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "discoveryRun",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 520,
        "y": 580,
        "wires": [
            [
                "0d6b1468c7e8402c"
            ],
            [
                "68e445fc2b0a42c7"
            ],
            [
                "9d3f4ffa65c1772b"
            ],
            [
                "1cf20926d2520c98"
            ],
            [
                "d6d1322b9d745884"
            ]
        ]
    },
    {
        "id": "0d6b1468c7e8402c",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Set \"Events Get Stream\" state",
        "func": "if (msg.payload == \"ON\") {\n    global.set(\"eventsGetStream\",true)\n} else {\n    global.set(\"eventsGetStream\",false)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "30a5d1b17151aadd",
        "type": "link out",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Triigger Event Flow Restart",
        "mode": "link",
        "links": [
            "9f8f72780fcd08cd"
        ],
        "x": 1120,
        "y": 660,
        "wires": [],
        "l": true
    },
    {
        "id": "affcfc4989bec16b",
        "type": "inject",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Automatic Events Connection",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "START",
        "payloadType": "str",
        "x": 210,
        "y": 100,
        "wires": [
            [
                "aa5f06d40fe8cb5a"
            ]
        ]
    },
    {
        "id": "ca6fbeb5c26fcf8c",
        "type": "rbe",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Block Repeat Messages",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "property": "payload",
        "x": 1030,
        "y": 160,
        "wires": [
            [
                "86020bb309d0ae86"
            ]
        ]
    },
    {
        "id": "aa5f06d40fe8cb5a",
        "type": "sse-client",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Start Event Flow",
        "url": "http://192.168.1.4:8080/rest/events",
        "events": [],
        "headers": {},
        "proxy": "",
        "restart": true,
        "rejectUnauthorized": false,
        "withCredentials": false,
        "timeout": "30",
        "x": 460,
        "y": 140,
        "wires": [
            [
                "5c0b50257b9bbe74"
            ]
        ]
    },
    {
        "id": "c858ec7c0b44668c",
        "type": "mqtt out",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "RV - Local",
        "topic": "",
        "qos": "",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "4410210f.6939c",
        "x": 1510,
        "y": 120,
        "wires": []
    },
    {
        "id": "73638f0d908217b1",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Format Inbound Message",
        "func": "function capitolizeFirst(string) {\n var output = string.replace(/\\w\\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});\n return output;\n}\n\nfunction roundNum1(i) {\n    i = Number(i)\n    i = i.toFixed(1)\n    i = Number(i)\n    return i\n}\n\nmsg.payload = JSON.parse(msg.payload)\n//msg.payload.payload = JSON.parse(msg.payload.payload)\n\nmsg1 = {}\nmsg1.payload = JSON.parse(msg.payload.payload)\nmsg1.topic = msg.payload.topic\nmsg1.event = msg.event\nif (msg1.topic.includes(\"smarthome/things/idsmyrv:\") === true &&\n    msg1.topic.includes(\"/status\") === true) {\n        msg1.payload.status = msg1.payload.status.toLowerCase()\n        msg1.payload.statusDetail = capitolizeFirst(msg1.payload.statusDetail)\n    }\n    \nif (msg1.topic.includes(\"smarthome/items/idsmyrv_\") === true) {\n    if (isNaN(parseInt(msg1.payload.value)) == true) {\n        msg1.payload.value = msg1.payload.value.toLowerCase()\n    } else {\n        msg1.payload.value = roundNum1(parseFloat(msg1.payload.value))\n    }\n}\n\n\nreturn msg1;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 160,
        "wires": [
            [
                "e3142aa105a58b6f"
            ]
        ]
    },
    {
        "id": "b8221c75079a0d4c",
        "type": "comment",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "This section connects to the OneControl system and pulls down event and state change info and writes it to MQTT",
        "info": "",
        "x": 810,
        "y": 60,
        "wires": []
    },
    {
        "id": "a7a4976dfe29fe86",
        "type": "debug",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 160,
        "wires": []
    },
    {
        "id": "86020bb309d0ae86",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Convert Data",
        "func": "\n\n// ***** Reformat hvac_mode.  Openhab uses \"heatcool\", and Home Assistant uses \"heat_cool\"\nif (msg.topic.includes(\"idsmyrv_hvac_thing_\")  === true &&\n        msg.topic.includes(\"_hvac_mode/state\")  === true && \n        msg.payload.value.includes(\"heatcool\")  === true){\n        msg.payload.value = \"heat_cool\"\n    }\n\nif (msg.topic.includes(\"idsmyrv_hvac_thing_\")  === true &&\n        msg.topic.includes(\"_heat-source/state\")  === true ){ \n        switch(msg.payload.value) {\n            case \"HEATPUMP\":\n                msg.payload.value = \"Prefer Heatpump\"\n                break;\n            case \"GAS\":\n                msg.payload.value = \"Prefer Gas\"\n                break;\n            }\n        }\n        \n/*\n// OneControl uses HSV color codes for RGB light objects, but HA only knows HS.  This will get the \n//  brightness from OneControl, and save it as a flow variable.  When it is up dated by either HA or OneControl,\n//  it is appended to the HS value from HomeAssistant before being sent to OneControl\n if (msg.topic.includes(\"idsmyrv_rgb_light_thing_\")  === true &&\n        msg.topic.includes(\"_hsvcolor/state\")  === true && \n        msg.topic.includes(\"_hsvcolor/statechanged\")  === false && \n        msg.payload.type.includes(\"HSB\")  === true){\n            i = msg.topic.split(\"/\")\n            j = i[2].split(\"_\")\n            msg1 = {}\n            values = msg.payload.value.split(\",\")\n            msg1.payload = values[0]+\",\"+ values[1]\n            msg1.topic = msg.topic\n            msg1.i = j\n            node.send(msg1)\n            msg1.topic = \"smarthome/items/\" + j[0] +\"_\"+ j[1] +\"_\"+ j[2] +\"_\"+j[3] +\"_\"+j[4] +\"_dimmer/ha_state\"\n            msg1.payload = values[2]\n            node.send(msg1)\n            msg = null\n    }\n    */\nif (msg.topic.includes(\"smarthome/things/idsmyrv:\")  === true) {\n    msg.retain = true\n}\n\n// OneControl uses the same topic for the ON/OFF and brightness values for dimmable lights.  To make things cleaner \n//   on our interface, we will split the inbound values and copy them to separate state topics - brightness and switch.\n//   Home Assistant will read the values from these two topics but write to the topic expected by OneControl - dimmer.\n//     Example:\n//       1) Inbound message comes to 'smarthome/items/idsmyrv_light_thing_0000000DA6BB1407_dimmer/state'\n//          Typical payload looks like '{\"type\":\"Percent\",\"value\":\"61\"}' or '{\"type\":\"OnOff\",\"value\":\"off\"}''\n//       2) Node Red splits the contents based on whether the value is a \"type\" is \"Percent\" or \"OnOff\n//       3) \"Percent\" is sent to 'smarthome/items/idsmyrv_light_thing_0000000DA6BB1407_brightness/state'\n//       4) \"OnOff\" is sent to 'smarthome/items/idsmyrv_light_thing_0000000DA6BB1407_switch/state'\nif (msg.topic.includes(\"_dimmer/state\") === true ) {\n    msg1 = {}\n    msg1.payload = msg.payload.value\n    switch (msg.payload.type) {\n        case \"Percent\":\n            msg1.topic = msg.topic.replace(\"_dimmer\",\"_brightness\")\n            node.send(msg1)\n            break;\n        case \"OnOff\":\n            msg1.topic = msg.topic.replace(\"_dimmer\",\"_switch\")\n            node.send(msg1)\n            break;\n        }\n}\n/* \n// OneControl uses the same topic for the ON/OFF and status values for the generator swtich.  To prevent state errors \n//   in Home Assistant, we need to split off the non-OnOff messages to a seperate topic and then build a separate text sensor to \n//   display this information.\n\nif (msg.topic.includes(\"_command/state\") === true &&\n        msg.topic.includes(\"generator\") === true) {\n    msg1 = {}\n    if (msg.payload.type != \"OnOff\") {\n        msg1.topic= msg.topic.replace(\"_command\",\"_status\")\n        msg1.payload = msg.payload.value\n        node.send(msg1)\n    } else {\n        \n}\n*/\nreturn msg\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 140,
        "wires": [
            [
                "c858ec7c0b44668c",
                "a7a4976dfe29fe86"
            ]
        ],
        "info": "This node is used to translate between the two platforms.  In come cases, values need to be in upper case, some lower case, and some different vlaues entirely."
    },
    {
        "id": "e3142aa105a58b6f",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Raw Data Format Conversions *",
        "func": "function roundNum0(i) {\n    i = Number(i)\n    i = i.toFixed(0)\n    i = Number(i)\n    return i\n}\n\nfunction roundNum1(i) {\n    i = Number(i)\n    i = i.toFixed(1)\n    i = Number(i)\n    return i\n}\n\n// Round amperage to .1\nif (msg.topic.includes(\"smarthome/items/idsmyrv_\")  === true &&\n        msg.topic.includes(\"_current/state\")  === true && \n        msg.payload.type.includes(\"Decimal\")  === true){\n    msg.payload.value = roundNum1(msg.payload.value)\n}\n\nif (msg.topic.includes(\"smarthome/items/idsmyrv_\")  === true &&\n        msg.topic.includes(\"statechanged\")  === true ) {\n            switch(msg.payload.type) {\n                case \"Decimal\":\n                    msg.payload.value = roundNum0(msg.payload.value)\n                    break;\n                default:\n                    msg.payload.value = msg.payload.value.toLowerCase()\n                    break;\n            }\n            switch(msg.payload.oldType) {\n                case \"Decimal\":\n                    msg.payload.oldValue = roundNum0(msg.payload.oldValue)\n                    break;\n                case \"String\":\n                    msg.payload.oldValue = msg.payload.oldValue.toLowerCase()\n                    break;\n            }\n        }\n\n//msg.payload.value = msg.payload.value.toLowerCase()\n\n// Round temperature to .0\nif (msg.topic.includes(\"smarthome/items/idsmyrv_\")  === true &&\n        msg.topic.includes(\"_temperature/state\")  === true && \n        msg.payload.type.includes(\"Decimal\")  === true){\n    msg.payload.value = roundNum0(msg.payload.value)\n}\n\n// Round HS values from HA\n\n\n// Force lowercase status modes\nif (msg.topic.includes(\"smarthome/things/idsmyrv:\")  === true &&\n        msg.topic.includes(\"/status\")  === true &&\n        msg.topic.includes(\"/statuschanged\")  === false) {\n    msg.payload.status = msg.payload.status.toLowerCase()\n    msg.payload.statusDetail = msg.payload.statusDetail.toLowerCase()\n}\n\n\n\n\nreturn msg;\n\n/*\nif (typeof(msg.payload.value) == \"string\") {\n    msg.payload.value = msg.payload.value.toLowerCase()\n}\n\n// Force lowercase statuschanged modes\nif (msg.topic.includes(\"smarthome/things/idsmyrv:\")  === true &&\n        msg.topic.includes(\"/statuschanged\")  === true &&\n        msg.payload.type.includes(\"String\")  === true ) {\n    msg.payload.value = msg.payload.value.toLowerCase()\n    if (msg.payload.oldType === \"String\") {\n       msg.payload.oldValue = msg.payload.oldValue.toLowerCase()\n }\n\nsmarthome/items/idsmyrv_hvac_thing_0000000DA7271001_hvac_mode/state\n\n\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 120,
        "wires": [
            [
                "ca6fbeb5c26fcf8c"
            ]
        ],
        "info": "This node is used to round decimal values down to reasonable sizes to minimize the number of state changes as well as \nthe number of MQTT messages that need to be processed.  It is also used to force certain values to lowercase which is needed for compatibility with Home Assistance"
    },
    {
        "id": "5c0b50257b9bbe74",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Is Event Get Stream enabled?",
        "func": "if (global.get(\"eventsGetStream\") == true ) {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 120,
        "wires": [
            [
                "73638f0d908217b1"
            ]
        ]
    },
    {
        "id": "4f9578a7eba52f1d",
        "type": "inject",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Manual Events Connection",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "START",
        "payloadType": "str",
        "x": 230,
        "y": 180,
        "wires": [
            [
                "aa5f06d40fe8cb5a"
            ]
        ]
    },
    {
        "id": "9f8f72780fcd08cd",
        "type": "link in",
        "z": "43b59d10c7fbb603",
        "g": "6aae06d09c613fad",
        "name": "Triigger Event Flow Restart",
        "links": [
            "30a5d1b17151aadd"
        ],
        "x": 220,
        "y": 140,
        "wires": [
            [
                "aa5f06d40fe8cb5a"
            ]
        ],
        "l": true
    },
    {
        "id": "68e445fc2b0a42c7",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Set \"Events Send Stream\" state",
        "func": "if (msg.payload == \"ON\") {\n    global.set(\"eventsSendStream\",true)\n} else {\n    global.set(\"eventsSendStream\",false)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "d6d1322b9d745884",
        "type": "link out",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Trigger OneControl Discovery",
        "mode": "link",
        "links": [
            "489f1d4567f2e9fe"
        ],
        "x": 810,
        "y": 680,
        "wires": [],
        "l": true
    },
    {
        "id": "9d3f4ffa65c1772b",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Remove All Entities",
        "func": "msg.oldstate = global.get(\"mqttDeleteAll\")\nglobal.set(\"mqttDeleteAll\",true)\nnode.send(msg)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 600,
        "wires": [
            [
                "94ae0ec5e36d0e7b",
                "93753410a1771126"
            ]
        ]
    },
    {
        "id": "94ae0ec5e36d0e7b",
        "type": "link out",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Trigger Delete All",
        "mode": "link",
        "links": [
            "489f1d4567f2e9fe"
        ],
        "x": 1090,
        "y": 580,
        "wires": [],
        "l": true
    },
    {
        "id": "93753410a1771126",
        "type": "delay",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1060,
        "y": 620,
        "wires": [
            [
                "8d475c51d06f4ba7"
            ]
        ]
    },
    {
        "id": "8d475c51d06f4ba7",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Reset Delete All Entities State",
        "func": "\nglobal.set(\"mqttDeleteAll\",msg.oldstate)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 620,
        "wires": [
            [
                "00417d306bc2e61c"
            ]
        ]
    },
    {
        "id": "00417d306bc2e61c",
        "type": "debug",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 560,
        "wires": []
    },
    {
        "id": "3b970ff7deaf8436",
        "type": "comment",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "This section process commands sent from the entities created in Home Assistant to manage this integration",
        "info": "",
        "x": 810,
        "y": 480,
        "wires": []
    },
    {
        "id": "1cf20926d2520c98",
        "type": "function",
        "z": "43b59d10c7fbb603",
        "g": "b81fcae9f8b73e0b",
        "name": "Discovery All Entities",
        "func": "msg.oldstate = global.get(\"mqttDeleteAll\")\nglobal.set(\"mqttDeleteAll\",false)\nnode.send(msg)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 640,
        "wires": [
            [
                "93753410a1771126",
                "30a5d1b17151aadd"
            ]
        ]
    },
    {
        "id": "2ab54f412889170c",
        "type": "http request",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "Get List of Things",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://192.168.1.4:8080/rest/things/",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 370,
        "y": 140,
        "wires": [
            [
                "22e486b014509a50",
                "3d605545bfab8cd3"
            ]
        ]
    },
    {
        "id": "22e486b014509a50",
        "type": "debug",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "Debug Output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 140,
        "wires": []
    },
    {
        "id": "0e37680e62b8250e",
        "type": "inject",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "Trigger Get",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 190,
        "y": 140,
        "wires": [
            [
                "2ab54f412889170c"
            ]
        ]
    },
    {
        "id": "398ef1a0a16d08f0",
        "type": "file",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "Write to /config/OneControl_things.json",
        "filename": "/config/OneControl_things.json",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 680,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "018e9d1e4c093a3e",
        "type": "comment",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "This group will export your OneControl nodes to a local JSON file",
        "info": "",
        "x": 310,
        "y": 100,
        "wires": []
    },
    {
        "id": "3d605545bfab8cd3",
        "type": "json",
        "z": "fbf3308551f314be",
        "g": "a2d4a149bd5c14b2",
        "name": "Format JSON Output",
        "property": "payload",
        "action": "",
        "pretty": true,
        "x": 480,
        "y": 180,
        "wires": [
            [
                "398ef1a0a16d08f0"
            ]
        ]
    },
    {
        "id": "4b0a7bd2a236a93c",
        "type": "catch",
        "z": "fbf3308551f314be",
        "name": "Capture Errors",
        "scope": null,
        "uncaught": false,
        "x": 1020,
        "y": 40,
        "wires": [
            [
                "3853971f7107f370",
                "82708c5f3772d522"
            ]
        ]
    },
    {
        "id": "3853971f7107f370",
        "type": "debug",
        "z": "fbf3308551f314be",
        "name": "Errors - Full Payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 40,
        "wires": []
    },
    {
        "id": "82708c5f3772d522",
        "type": "debug",
        "z": "fbf3308551f314be",
        "name": "Errors - Just message",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "error",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 80,
        "wires": []
    }
]